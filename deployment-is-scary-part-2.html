<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">

  <link rel="stylesheet" href="http://blog.jimjh.com/theme/css/style.min.css?3afacc2d">

  <link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono'>
  <link rel='stylesheet' type='text/css' href='http://cdn-images.mailchimp.com/embedcode/slim-081711.css'>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Jim Lim">

  <meta property="og:site_name" content="Ampersand">
  <meta property="fb:admins" content="jimjh">

  <link href="http://feeds.feedburner.com/jimjh/blog" type="application/rss+xml" rel="alternate" title="Ampersand Full RSS Feed" />

  <meta name="keywords" content="ruby, rails">
  <meta name="description" content="Deployment is Scary - Part 2 by Jim Lim">
  <meta property="og:description" content="Deployment is Scary - Part 2 by Jim Lim">
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Jim Lim">
  <meta property="og:title" content="Deployment is Scary - Part 2">
  <meta property="og:url" content="http://blog.jimjh.com/deployment-is-scary-part-2.html">

  <title>
Deployment is Scary - Part 2  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5604647-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  setTimeout("_gaq.push(['_trackEvent', '15_seconds', 'read'])", 15000);
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="http://blog.jimjh.com">
        <img src="http://blog.jimjh.com/images/jimjh.png" alt="logo">
      </a>
      <h2><a href="http://blog.jimjh.com">Jim Lim</a></h2>
      <p></p>
      <ul>
        <li>
          <a href="http://feeds.feedburner.com/jimjh/blog" title="Subscribe to my feed" rel="alternate" type="application/rss+xml">RSS</a>
        </li>
        <li><a href="http://jimjh.com" target="_blank">Profile</a></li>
      </ul>
<div id="mc_embed_signup">
  <form action="http://jimjh.us7.list-manage.com/subscribe/post?u=384f06163c70729da8e51b396&amp;id=162cf33799" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
  </form>
</div>
    </div>
  </aside>

  <main>
    <header>
  <p>Posted on Fri 24 May 2013</p>
    </header>

  <article>
    <div id="article_title">
      <h3><a href="http://blog.jimjh.com/deployment-is-scary-part-2.html">Deployment is Scary - Part 2</a></h3>
    </div>
    <div id="article_text">
      <p>The is the second installation of a series of posts about my deployment experiences with Enteract. Part 1 is available <a href="http://blog.jimjh.com/deployment-is-scary-part-1.html">here</a>.</p>
<p>In this post, I will focus on our use of <a href="https://github.com/lostisland/faraday">Faraday</a> and <a href="http://upstart.ubuntu.com/">Upstart</a> for some simple monitoring.</p>
<h2>Faraday</h2>
<p>We wanted a tool to monitor the web application and notify a member of the team should the web application be unreachable or defaced. The first requirement was relatively simple, and can be easily satisfied by using Amazon's Elastic Load Balancer with the <a href="https://github.com/ianheggie/health_check">health check</a> gem for Rails.</p>
<p>The second requirement was slightly trickier, and I wrote a ruby script using Faraday that periodically</p>
<ul>
<li>visits the sign in page,</li>
<li>signs in,</li>
<li>visits the home page,</li>
<li>ensures that the names of all 24 entries exist on the page, and</li>
<li>notifies the team, via text messages, should any of the assertions fail.</li>
</ul>
<p>(On hindsight, it would have been much easier to use Capybara or JMeter for this purpose; I was using this as an excuse to learn how to use Faraday and Amazon's <a href="http://aws.amazon.com/sns/">Simple Notification Service</a>.)</p>
<p>I uploaded a <a href="https://gist.github.com/jimjh/5646333">gist</a> of the relevant script with the sensitive information redacted. The only tricky part was retrieving the CSRF token and preserving cookie information between requests.</p>
<h2>Upstart</h2>
<p>Next, I wanted to some reasonably reliable way to ensure that the monitoring process is alive - it wouldn't be a very useful monitoring tool if the process terminates prematurely. For this we used Upstart, an event-based init daemon that supervises the process and restarts it if it terminates.</p>
<p>The configuration file that worked for me is as follows:</p>
<script src="https://gist.github.com/jimjh/5646473.js"></script>

<p>There is probably an easier to set this up that uses a shorter command.</p>
    </div>
    <div id="article_meta">
      <p>Category: <a href="http://blog.jimjh.com/category/software.html">Software</a></p>
      <p>Tags:
        <a href="http://blog.jimjh.com/tag/ruby.html">ruby</a>,        <a href="http://blog.jimjh.com/tag/rails.html">rails</a>      </p>
    </div>
  </article>

    <footer>
  <p><a href="http://blog.jimjh.com/" class="button_accent">&larr; Back to Index</a></p>
  <div id="comments">
    <div id="respond">
      <div id="disqus_thread"></div>
          <script type="text/javascript">
              var disqus_shortname = 'jimjh';

              /* * * DON'T EDIT BELOW THIS LINE * * */
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div><!-- #respond -->
</div><!-- #comments -->
    </footer>

    <div id="ending_message">
      <p>
<a href='http://jimjh.com'>Jim Lim</a> &sdot;
<a href='https://plus.google.com/111805949132881507016' rel='author'>G+</a>
&sdot;
<a href='https://github.com/jimjh'>GitHub</a> &sdot;
<a href='http://www.linkedin.com/in/jimjh'>LinkedIn</a> &sdot;
<a href='http://stackoverflow.com/users/473709/jim-lim'>StackOverflow</a>
&sdot;
<a href="http://www.ontoplist.com/" title="Online Marketing"
target="_blank">ontoplist</a>
 &sdot; Theme by Giulio Fidente.</p>
    </div>
  </main>
</body>
</html>