<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="https://blog.jimjh.com/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="https://blog.jimjh.com/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="https://blog.jimjh.com/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="James Lim">
  <meta name="description" content="Posts and writings by James Lim">

  <link href="http://feeds.feedburner.com/jimjh/blog" type="application/rss+xml" rel="alternate" title="Ampersand RSS" />

<meta name="keywords" content="ruby, rails">

  <title>
    Ampersand
&ndash; Deployment is Scary - Part 2  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5604647-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="https://blog.jimjh.com">
        <img src="https://blog.jimjh.com/images/jimjh.png" alt="logo">
      </a>
      <h2><a href="https://blog.jimjh.com">James Lim</a></h2>
      <p></p>
      <ul>
        <li><a href="https://jimjh.com" target="_blank">Profile</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="https://blog.jimjh.com">Index</a> &brvbar; <a href="https://blog.jimjh.com/archives.html">Archives</a>
      &brvbar; <a href="http://feeds.feedburner.com/jimjh/blog">RSS</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h1><a href="https://blog.jimjh.com/deployment-is-scary-part-2.html">Deployment is Scary - Part 2</a></h1>
  </div>
  <div class="article_text">
    <p>The is the second installation of a series of posts about my deployment experiences with Enteract. Part 1 is available <a href="https://blog.jimjh.com/deployment-is-scary-part-1.html">here</a>.</p>
<p>In this post, I will focus on our use of <a href="https://github.com/lostisland/faraday">Faraday</a> and <a href="http://upstart.ubuntu.com/">Upstart</a> for some simple monitoring.</p>
<h2>Faraday</h2>
<p>We wanted a tool to monitor the web application and notify a member of the team should the web application be unreachable or defaced. The first requirement was relatively simple, and can be easily satisfied by using Amazon's Elastic Load Balancer with the <a href="https://github.com/ianheggie/health_check">health check</a> gem for Rails.</p>
<p>The second requirement was slightly trickier, and I wrote a ruby script using Faraday that periodically</p>
<ul>
<li>visits the sign in page,</li>
<li>signs in,</li>
<li>visits the home page,</li>
<li>ensures that the names of all 24 entries exist on the page, and</li>
<li>notifies the team, via text messages, should any of the assertions fail.</li>
</ul>
<p>(On hindsight, it would have been much easier to use Capybara or JMeter for this purpose; I was using this as an excuse to learn how to use Faraday and Amazon's <a href="http://aws.amazon.com/sns/">Simple Notification Service</a>.)</p>
<p>I uploaded a <a href="https://gist.github.com/jimjh/5646333">gist</a> of the relevant script with the sensitive information redacted. The only tricky part was retrieving the CSRF token and preserving cookie information between requests.</p>
<h2>Upstart</h2>
<p>Next, I wanted to some reasonably reliable way to ensure that the monitoring process is alive - it wouldn't be a very useful monitoring tool if the process terminates prematurely. For this we used Upstart, an event-based init daemon that supervises the process and restarts it if it terminates.</p>
<p>The configuration file that worked for me is as follows:</p>
<script src="https://gist.github.com/jimjh/5646473.js"></script>

<p>There is probably an easier to set this up that uses a shorter command.</p>
  </div>
  <div class="article_meta">
    <p>Posted on: Fri 24 May 2013</p>
    <p>Category: <a href="https://blog.jimjh.com/category/software.html">Software</a>
 &ndash; Tags:
      <a href="https://blog.jimjh.com/tag/ruby.html">ruby</a>,      <a href="https://blog.jimjh.com/tag/rails.html">rails</a>    </p>
  </div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = "deployment-is-scary-part-2.html";
        (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = '//jimjh.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
    </script>
  </div>

</article>


    <div id="ending_message">
      <p>&copy; James Lim. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. </p>
    </div>
  </main>
</body>
</html>