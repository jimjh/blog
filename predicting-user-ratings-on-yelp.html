<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="https://blog.jimjh.com/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="https://blog.jimjh.com/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="https://blog.jimjh.com/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="James Lim">
  <meta name="description" content="Posts and writings by James Lim">

  <link href="http://feeds.feedburner.com/jimjh/blog" type="application/rss+xml" rel="alternate" title="Ampersand RSS" />

<meta name="keywords" content="machine learning, matlab, yelp">

  <title>
    Ampersand
&ndash; Predicting User Ratings on Yelp  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5604647-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <h2><a href="https://blog.jimjh.com">Ampersand</a></h2>
      <p>Moved to Medium in 2019.</p>
      <ul>
        <li><a href="https://medium.com/@jimjh" target="_blank">Medium</a></li>
        <li><a href="https://jimjh.com" target="_blank">Profile</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="https://blog.jimjh.com">Index</a> &brvbar; <a href="https://blog.jimjh.com/archives.html">Archives</a>
      &brvbar; <a href="http://feeds.feedburner.com/jimjh/blog">RSS</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h1><a href="https://blog.jimjh.com/predicting-user-ratings-on-yelp.html">Predicting User Ratings on Yelp</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 14 May 2013</p>
  </div>
  <div class="article_text">
    <p>Several weeks ago, Yelp launched a <a href="https://www.yelp.com/dataset_challenge/dataset">dataset challenge</a> and released data on their users and businesses in Phoenix, AZ. The challenge shared some similarities with the Netflix Prize, and I was curious to see if the Alternating Least Squares algorithm that I used for my <a href="https://blog.jimjh.com/downloads/2013/05/12/netflix.pdf">Netflix project</a>  was versatile enough to be used for predicting business ratings on Yelp. The results were disappointing, but I shall document the process here for my own reference. All of the code used is available in a <a href="https://github.com/jimjh/yelp-dataset-challenge">git repository</a>.</p>
<h2>Transforming the Data</h2>
<p>The dataset arrived in a tarball that unpacks into a directory of JSON files. Each JSON file could be imported into MongoDB relatively easily with the following command:</p>
<div class="highlight"><pre><span></span><span class="err">$</span><span class="o">&gt;</span> <span class="n">mongoimport</span> <span class="o">--</span><span class="n">db</span> <span class="n">yelp</span> <span class="o">--</span><span class="n">collection</span> <span class="n">reviews</span> <span class="o">--</span><span class="n">drop</span> <span class="o">--</span><span class="nb">file</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span>
</pre></div>


<p>However, since Yelp mangled the primary keys before exporting the dataset, we need to change the primary keys to consecutive integers before we can import the data into MatLab as a sparse matrix. This can be done using the following script (also available from the git repository):</p>
<script src="https://gist.github.com/jimjh/5581460.js"></script>

<p>The <code>reviews</code> collection may be exported to a CSV file that can be imported into MatLab.</p>
<h2>Decomposing the Matrix</h2>
<p>Using a <em>latent factor model</em>, we assume that each business has a set of features, and each user has a certain preference for each feature. Then, the rating that a user gives to a business <code>r_ij</code> is the dot product of the business's feature vector <code>b_i</code> and the user's preferences vector <code>u_j</code>. Putting everything together, we get <code>B Ã— U = R</code>, where <code>B</code> is the features matrix, <code>U</code> is the preferences matrix, and <code>R</code> is the ratings matrix.</p>
<p>The goal of the alternating least squares algorithm is thus to determine the matrices <code>B</code> and <code>U</code>, and then use these for predicting unknown ratings. (The full explanation of the model and the algorithm are available in my <a href="https://blog.jimjh.com/downloads/2013/05/12/netflix.pdf">project report</a>.)</p>
<p>Note that the model doesn't know exactly what these features are - it just guesses at a reasonable number of features.</p>
<h2>Measuring the Results</h2>
<p>The entire ratings matrix <code>R</code> was too large for my Macbook to handle, and I took a random sample of 2000 users and 2000 businesses, which gave me about 1780 known ratings. The model has two parameters: the number of latent factors, and the regularization factor (lambda). I fixed the number of latent factors at 20, and then used 5-fold cross validation to determine the best value for lambda.</p>
<p>The results were as follows:
<table>
  <tr>
    <th>Algorithm</th>
    <th>RMSE</th>
  </tr>
  <tr>
    <td>Plain ALS</td>
    <td>1.4688</td>
  </tr>
  <tr>
    <td>ALS w. Bias</td>
    <td>1.2365</td>
  </tr>
  <tr>
    <td>ALS w. Correction</td>
    <td>1.5045</td>
  </tr>
</table></p>
<h2>Possible Improvements</h2>
<p>The results were disappointing, given that the standard deviation of my sample was only 1.2077. In other words, ALS did worse than simply predicting the mean rating all the time. Other than fixing possible bugs in my code (maybe I somehow permuted the data?), I could potentially modify the algorithm as follows:</p>
<ul>
<li>Take into account known features and estimate user preferences for these.</li>
<li>Use a clustering algorithm on the locations of the businesses, since a user's preference for a business is likely to be affected by its location.</li>
</ul>
<p>I will post updates here if I figure out what is going wrong.</p>
  </div>
  <div class="article_meta">
    <p>Category: <a href="https://blog.jimjh.com/category/software.html">Software</a>
 &ndash; Tags:
      <a href="https://blog.jimjh.com/tag/machine-learning.html">machine learning</a>,      <a href="https://blog.jimjh.com/tag/matlab.html">matlab</a>,      <a href="https://blog.jimjh.com/tag/yelp.html">yelp</a>    </p>
  </div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = "predicting-user-ratings-on-yelp.html";
        (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = '//jimjh.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
    </script>
  </div>

</article>


    <div id="ending_message">
      <p>&copy; James Lim. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. </p>
    </div>
  </main>
</body>
</html>